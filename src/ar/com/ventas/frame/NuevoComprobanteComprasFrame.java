/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ar.com.ventas.frame;

import ar.com.ventas.entities.ComprobanteCompras;
import ar.com.ventas.entities.ComprobanteComprasDetalle;
import ar.com.ventas.entities.Configuracion;
import ar.com.ventas.entities.CuentaCorrienteProveedor;
import ar.com.ventas.entities.IvaCompras;
import ar.com.ventas.entities.Periodo;
import ar.com.ventas.entities.Proveedor;
import ar.com.ventas.entities.SeguimientoCompras;
import ar.com.ventas.services.ComprobanteComprasService;
import ar.com.ventas.services.ConfiguracionService;
import ar.com.ventas.services.PeriodoService;
import ar.com.ventas.services.ProveedorService;
import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.print.PageFormat;
import java.awt.print.Paper;
import java.awt.print.Printable;
import static java.awt.print.Printable.NO_SUCH_PAGE;
import static java.awt.print.Printable.PAGE_EXISTS;
import java.awt.print.PrinterException;
import java.awt.print.PrinterJob;
import static java.lang.Math.rint;
import java.util.Date;
import java.text.DecimalFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;

/**
 *
 * @author Administrador
 */
public class NuevoComprobanteComprasFrame extends javax.swing.JFrame {

    private String filtro;
    private List<Periodo> periodos = null;
    private List<Proveedor> proveedores = null;
    private Proveedor proveedorSeleccionado = null;
    private Integer codigoProveedor;
    private float iva = 0;
    private Configuracion conf = null;
    private Double gravado;
    private Double noGravado;
    private Double impuestoInterno;
    private Double percepcionIIBB;
    private Double percepcionIva;
    private Double importeIva;
    private Double otro;
    private Double importeTotal;
    private DecimalFormat df = new DecimalFormat("#0.00");
    private ComprobanteCompras comprobante;
    private SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");

    /**
     * Creates new form NuevoIvaVentas
     */
    public NuevoComprobanteComprasFrame(Date fd, Date fa, Integer row) {
        getContentPane().setBackground(new java.awt.Color(245, 222, 179));
        initComponents();
        cargarConfiguracion();
        limpiarCampos();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        guardarBtn = new javax.swing.JButton();
        volverBtn = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        jLabel10 = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        nroSucursalTxt = new javax.swing.JTextField();
        nroFacturTxt = new javax.swing.JTextField();
        jLabel13 = new javax.swing.JLabel();
        fechaFacturaTxt = new javax.swing.JTextField();
        comboLetraFactura = new javax.swing.JComboBox();
        comboProveedor = new javax.swing.JComboBox();
        gravadoTxt = new javax.swing.JTextField();
        impuestoInternoTxt = new javax.swing.JTextField();
        percepcionIIBBTxt = new javax.swing.JTextField();
        percepcionIvaTxt = new javax.swing.JTextField();
        otroTxt = new javax.swing.JTextField();
        ivaTxt = new javax.swing.JTextField();
        totalTxt = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        razonSocialProveedorBuscadoTxt = new javax.swing.JTextField();
        codigoProveedorTxt = new javax.swing.JTextField();
        buscarProveedorBtn = new javax.swing.JButton();
        jLabel14 = new javax.swing.JLabel();
        noGravadoTxt = new javax.swing.JTextField();
        jLabel15 = new javax.swing.JLabel();
        chekBtn = new javax.swing.JButton();
        facturaChk = new javax.swing.JRadioButton();
        notaCreditoChk = new javax.swing.JRadioButton();
        filtroTxt = new javax.swing.JTextField();
        comboPeriodos = new javax.swing.JComboBox<>();
        llevaStockChk = new javax.swing.JCheckBox();
        notaDebitoChk = new javax.swing.JRadioButton();
        llevaDetalleChk = new javax.swing.JCheckBox();
        detalle1Txt = new javax.swing.JTextField();
        detalle2Txt = new javax.swing.JTextField();
        detalle3Txt = new javax.swing.JTextField();
        detalle4Txt = new javax.swing.JTextField();
        impresionChk = new javax.swing.JCheckBox();
        jLabel12 = new javax.swing.JLabel();
        fechaTxt = new javax.swing.JTextField();
        prontoPagoChk = new javax.swing.JCheckBox();
        jLabel16 = new javax.swing.JLabel();
        diasTxt = new javax.swing.JTextField();
        fechaCalculoVencimientoTxt = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        setTitle("NUEVO COMPROBANTE COMPRAS");

        guardarBtn.setText("Guardar");
        guardarBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                guardarBtnActionPerformed(evt);
            }
        });

        volverBtn.setText("Volver");
        volverBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                volverBtnActionPerformed(evt);
            }
        });

        jLabel1.setText("Fecha Periodo:");

        jLabel2.setText("Letra y NÃºmero:");

        jLabel3.setText("Codigo Proveedor:");

        jLabel5.setText("Gravado:");

        jLabel6.setText("Imp. Interno:");

        jLabel7.setText("Percep.II BB:");

        jLabel8.setText("Percep. IVA:");

        jLabel9.setText("Otro:");

        jLabel10.setText("IVA:");

        jLabel11.setText("Total:");

        nroSucursalTxt.setText("Nro Sucursal");
        nroSucursalTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                nroSucursalTxtKeyPressed(evt);
            }
        });

        nroFacturTxt.setText("Nro Factura");
        nroFacturTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                nroFacturTxtKeyPressed(evt);
            }
        });

        jLabel13.setText("Fecha Factura:");

        fechaFacturaTxt.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        fechaFacturaTxt.setText("FECHA FACTURA");
        fechaFacturaTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                fechaFacturaTxtKeyPressed(evt);
            }
        });

        comboLetraFactura.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "", "A", "C", "M", "B", "X" }));
        comboLetraFactura.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                comboLetraFacturaActionPerformed(evt);
            }
        });
        comboLetraFactura.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                comboLetraFacturaKeyPressed(evt);
            }
        });

        comboProveedor.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        comboProveedor.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                comboProveedorActionPerformed(evt);
            }
        });
        comboProveedor.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                comboProveedorKeyPressed(evt);
            }
        });

        gravadoTxt.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        gravadoTxt.setText("GRAVADO");
        gravadoTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                gravadoTxtKeyPressed(evt);
            }
        });

        impuestoInternoTxt.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        impuestoInternoTxt.setText("IMP.INTERNO");
        impuestoInternoTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                impuestoInternoTxtKeyPressed(evt);
            }
        });

        percepcionIIBBTxt.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        percepcionIIBBTxt.setText("PERC.II BB");
        percepcionIIBBTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                percepcionIIBBTxtKeyPressed(evt);
            }
        });

        percepcionIvaTxt.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        percepcionIvaTxt.setText("PERCEP IVA");
        percepcionIvaTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                percepcionIvaTxtKeyPressed(evt);
            }
        });

        otroTxt.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        otroTxt.setText("OTRO");
        otroTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                otroTxtKeyPressed(evt);
            }
        });

        ivaTxt.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        ivaTxt.setText("IVA");
        ivaTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                ivaTxtKeyPressed(evt);
            }
        });

        totalTxt.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        totalTxt.setText("TOTAL");
        totalTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                totalTxtKeyPressed(evt);
            }
        });

        jLabel4.setText("Proveedor:");

        razonSocialProveedorBuscadoTxt.setText("RAZON SOCIAL PROVEEDOR");

        codigoProveedorTxt.setText("CODIGO PROVEEDOR");
        codigoProveedorTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                codigoProveedorTxtKeyPressed(evt);
            }
        });

        buscarProveedorBtn.setText("Buscar");
        buscarProveedorBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buscarProveedorBtnActionPerformed(evt);
            }
        });

        jLabel14.setText("No Gravado:");

        noGravadoTxt.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        noGravadoTxt.setText("NO GRAVADO");
        noGravadoTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                noGravadoTxtKeyPressed(evt);
            }
        });

        jLabel15.setText("Prov. A Buscar");

        chekBtn.setText("Chek");
        chekBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chekBtnActionPerformed(evt);
            }
        });

        facturaChk.setText("Factura");
        facturaChk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                facturaChkActionPerformed(evt);
            }
        });

        notaCreditoChk.setText("Nota CrÃ©dito");
        notaCreditoChk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                notaCreditoChkActionPerformed(evt);
            }
        });

        filtroTxt.setText("FILTRO");
        filtroTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                filtroTxtKeyPressed(evt);
            }
        });

        comboPeriodos.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        comboPeriodos.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                comboPeriodosKeyPressed(evt);
            }
        });

        llevaStockChk.setText("Lleva Stock");
        llevaStockChk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                llevaStockChkActionPerformed(evt);
            }
        });

        notaDebitoChk.setText("Nota DÃ©bito");
        notaDebitoChk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                notaDebitoChkActionPerformed(evt);
            }
        });

        llevaDetalleChk.setText("Lleva Detalle");
        llevaDetalleChk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                llevaDetalleChkActionPerformed(evt);
            }
        });
        llevaDetalleChk.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                llevaDetalleChkKeyPressed(evt);
            }
        });

        detalle1Txt.setText("DETALLE 1");
        detalle1Txt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                detalle1TxtKeyPressed(evt);
            }
        });

        detalle2Txt.setText("DETALLE 2");
        detalle2Txt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                detalle2TxtKeyPressed(evt);
            }
        });

        detalle3Txt.setText("DETALLE 3");
        detalle3Txt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                detalle3TxtKeyPressed(evt);
            }
        });

        detalle4Txt.setText("DETALLE 4");
        detalle4Txt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                detalle4TxtKeyPressed(evt);
            }
        });

        impresionChk.setText("ImpresiÃ³n Detalle");

        jLabel12.setText("Fecha Entrega:");

        fechaTxt.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        fechaTxt.setText("FECHA");
        fechaTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                fechaTxtKeyPressed(evt);
            }
        });

        prontoPagoChk.setText("Pronto Pago");
        prontoPagoChk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                prontoPagoChkActionPerformed(evt);
            }
        });
        prontoPagoChk.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                prontoPagoChkKeyPressed(evt);
            }
        });

        jLabel16.setText("DÃ­as de vencimiento:");

        diasTxt.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        diasTxt.setText("DIAS");
        diasTxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                diasTxtKeyPressed(evt);
            }
        });

        fechaCalculoVencimientoTxt.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        fechaCalculoVencimientoTxt.setText("Fe.Cal.Vto");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(jLabel3)
                                    .addComponent(jLabel5)
                                    .addGroup(layout.createSequentialGroup()
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                            .addComponent(jLabel8)
                                            .addComponent(jLabel7)
                                            .addComponent(jLabel9)
                                            .addComponent(jLabel10)
                                            .addComponent(jLabel11))
                                        .addGap(1, 1, 1))
                                    .addComponent(jLabel14))
                                .addComponent(jLabel6, javax.swing.GroupLayout.Alignment.TRAILING))
                            .addComponent(jLabel4))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(codigoProveedorTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 134, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(jLabel15))
                                    .addComponent(razonSocialProveedorBuscadoTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 255, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(facturaChk))
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addGroup(layout.createSequentialGroup()
                                                .addComponent(filtroTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(18, 18, 18)
                                                .addComponent(buscarProveedorBtn))
                                            .addGroup(layout.createSequentialGroup()
                                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                    .addComponent(llevaStockChk)
                                                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                                        .addComponent(llevaDetalleChk)
                                                        .addGroup(layout.createSequentialGroup()
                                                            .addComponent(notaCreditoChk)
                                                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                                            .addComponent(notaDebitoChk))))
                                                .addGap(24, 24, 24)
                                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                    .addGroup(layout.createSequentialGroup()
                                                        .addComponent(fechaTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                        .addComponent(diasTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 46, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addGap(34, 34, 34))
                                                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                            .addComponent(jLabel12)
                                                            .addComponent(prontoPagoChk))
                                                        .addGap(32, 48, Short.MAX_VALUE)
                                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                            .addComponent(fechaCalculoVencimientoTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 99, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                            .addComponent(jLabel16)))))))
                                    .addGroup(layout.createSequentialGroup()
                                        .addGap(7, 7, 7)
                                        .addComponent(comboProveedor, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                            .addComponent(percepcionIIBBTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 89, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(gravadoTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 102, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                    .addComponent(totalTxt, javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(ivaTxt, javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(noGravadoTxt, javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(otroTxt, javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(percepcionIvaTxt, javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(impuestoInternoTxt, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 106, Short.MAX_VALUE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(chekBtn)
                                        .addGap(174, 174, 174)
                                        .addComponent(impresionChk)
                                        .addGap(0, 0, Short.MAX_VALUE))
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(guardarBtn)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(volverBtn))))))
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                        .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                            .addComponent(jLabel1)
                            .addGap(18, 18, 18)
                            .addComponent(comboPeriodos, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                            .addComponent(jLabel13)
                            .addGap(18, 18, 18)
                            .addComponent(fechaFacturaTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 153, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(comboLetraFactura, javax.swing.GroupLayout.PREFERRED_SIZE, 64, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(nroSucursalTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 87, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(detalle1Txt)
                            .addComponent(detalle2Txt)
                            .addComponent(detalle3Txt)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(nroFacturTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 163, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(0, 0, Short.MAX_VALUE))
                            .addComponent(detalle4Txt))))
                .addGap(18, 18, 18))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(codigoProveedorTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel15)
                    .addComponent(buscarProveedorBtn)
                    .addComponent(filtroTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(comboProveedor, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(razonSocialProveedorBuscadoTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel4))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(comboPeriodos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(llevaStockChk)
                    .addComponent(jLabel12)
                    .addComponent(jLabel16))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel13)
                    .addComponent(fechaFacturaTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(facturaChk)
                    .addComponent(notaCreditoChk)
                    .addComponent(notaDebitoChk)
                    .addComponent(fechaTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(diasTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(comboLetraFactura, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(nroSucursalTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(nroFacturTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(llevaDetalleChk)
                    .addComponent(prontoPagoChk)
                    .addComponent(fechaCalculoVencimientoTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(gravadoTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(detalle1Txt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel14)
                    .addComponent(noGravadoTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(detalle2Txt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(impuestoInternoTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6)
                    .addComponent(detalle3Txt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(percepcionIIBBTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(detalle4Txt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(percepcionIvaTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel9)
                    .addComponent(otroTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(chekBtn)
                    .addComponent(impresionChk))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel10)
                    .addComponent(ivaTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel11)
                    .addComponent(totalTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(guardarBtn)
                    .addComponent(volverBtn))
                .addContainerGap(35, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void guardarBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_guardarBtnActionPerformed
        guardar();
        codigoProveedorTxt.requestFocus();
    }//GEN-LAST:event_guardarBtnActionPerformed

    private void volverBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_volverBtnActionPerformed
        // System.exit(0);
        AbmComprobantesCompraFrame av = new AbmComprobantesCompraFrame(null, null, -1);
        av.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_volverBtnActionPerformed

    private void comboProveedorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_comboProveedorActionPerformed
        if (comboProveedor.getSelectedIndex() > 0) {
            filtroTxt.setText("");
            Integer seleccion = comboProveedor.getSelectedIndex();
            try {
                proveedorSeleccionado = new ProveedorService().getProveedoresByFiltro(filtro).get(seleccion);
            } catch (Exception ex) {
                Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
            razonSocialProveedorBuscadoTxt.setText(proveedorSeleccionado.getRazonSocial());
            codigoProveedorTxt.setText(proveedorSeleccionado.getCodigo().toString());
        }
    }//GEN-LAST:event_comboProveedorActionPerformed

    private void buscarProveedorBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buscarProveedorBtnActionPerformed
        if (codigoProveedorTxt.getText().isEmpty()) {
            if (filtroTxt.getText().isEmpty()) {
                JOptionPane.showMessageDialog(this, "No se indicÃ³ que buscar");
                return;
            } else {
                buscarProvPorFiltro();
            }
        } else {
            buscarProvPorCodigo();
        }
    }//GEN-LAST:event_buscarProveedorBtnActionPerformed

    private void comboLetraFacturaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_comboLetraFacturaActionPerformed
        if (proveedorSeleccionado == null) {
            return;
        }
        if (evt.getModifiers() == 16) {
            gravadoTxt.setText("");
            noGravadoTxt.setText("");
            impuestoInternoTxt.setText("");
            percepcionIIBBTxt.setText("");
            percepcionIvaTxt.setText("");
            otroTxt.setText("");
            ivaTxt.setText("");
            totalTxt.setText("");
            int g = comboLetraFactura.getSelectedIndex();
            if (g < 5) {
                llevaDetalleChk.setSelected(false);
                detalleNo();
            }
            if (comboLetraFactura.getSelectedIndex() > 0) {
                if (comboLetraFactura.getSelectedItem() == "A"
                        || comboLetraFactura.getSelectedItem() == "M"
                        || comboLetraFactura.getSelectedItem() == "C") {
                    String cui = proveedorSeleccionado.getCuit().substring(0, 6);
                    if (cui.equals("11-111")) {
                        JOptionPane.showMessageDialog(this, "El proveedor no tiene un cuit vÃ¡lido");
                        return;
                    }
                    gravadoTxt.setEditable(true);
                    noGravadoTxt.setEditable(false);
                    impuestoInternoTxt.setEditable(true);
                    percepcionIIBBTxt.setEditable(true);
                    percepcionIvaTxt.setEditable(true);
                    otroTxt.setEditable(true);
                    ivaTxt.setEditable(true);
                    totalTxt.setEditable(true);
                } else {
                    gravadoTxt.setEditable(false);
                    noGravadoTxt.setEditable(true);
                    impuestoInternoTxt.setEditable(false);
                    percepcionIIBBTxt.setEditable(false);
                    percepcionIvaTxt.setEditable(false);
                    otroTxt.setEditable(true);
                    ivaTxt.setEditable(false);
                    totalTxt.setEditable(true);
                }
            }
        }
    }//GEN-LAST:event_comboLetraFacturaActionPerformed

    private void chekBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chekBtnActionPerformed
        calcularTotales();
    }//GEN-LAST:event_chekBtnActionPerformed

    private void codigoProveedorTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_codigoProveedorTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            if (codigoProveedorTxt.getText().isEmpty()) {
                filtroTxt.requestFocus();
            } else {
                buscarProvPorCodigo();
            }
        }
    }//GEN-LAST:event_codigoProveedorTxtKeyPressed

    private void filtroTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_filtroTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            if (filtroTxt.getText().isEmpty()) {
                codigoProveedorTxt.requestFocus();
            } else {
                buscarProvPorFiltro();
            }
        }
    }//GEN-LAST:event_filtroTxtKeyPressed

    private void comboProveedorKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_comboProveedorKeyPressed
        if (evt.getKeyCode() == 10) {
            int row = comboProveedor.getSelectedIndex();
            proveedorSeleccionado = proveedores.get(row);
            codigoProveedorTxt.setText(String.valueOf(proveedorSeleccionado.getCodigo()));
            buscarProvPorCodigo();
        }
    }//GEN-LAST:event_comboProveedorKeyPressed

    private void facturaChkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_facturaChkActionPerformed
        llevaDetalleChk.setSelected(false);
        facturaChk.setSelected(true);
        notaCreditoChk.setSelected(false);
        notaDebitoChk.setSelected(false);
        detalleNo();
        fechaTxt.requestFocus();
    }//GEN-LAST:event_facturaChkActionPerformed

    private void notaCreditoChkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_notaCreditoChkActionPerformed
        facturaChk.setSelected(false);
        notaCreditoChk.setSelected(true);
        notaDebitoChk.setSelected(false);
        fechaTxt.requestFocus();
    }//GEN-LAST:event_notaCreditoChkActionPerformed

    private void fechaFacturaTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_fechaFacturaTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            if (fechaFacturaTxt.getText().isEmpty()) {
                fechaFacturaTxt.setText(sdf.format(new Date()));
                fechaFacturaTxt.requestFocus();
            } else {
                notaCreditoChk.setEnabled(true);
                int largo = fechaFacturaTxt.getText().length();
                if (largo == 2) {
                    Calendar cal = Calendar.getInstance();
                    int mes = cal.get(Calendar.MONTH) + 1;
                    int anio = cal.get(Calendar.YEAR);
                    String an = String.valueOf(anio);
                    String f = "0" + String.valueOf(mes);
                    if (f.length() > 2) {
                        f = f.substring(1, 3);
                    }
                    f = f + "/" + an;
                    fechaFacturaTxt.setText(fechaFacturaTxt.getText() + "/" + f);
                    fechaTxt.requestFocus();
                } else {
                    if (largo == 5) {
                        Calendar cal = Calendar.getInstance();
                        int anio = cal.get(Calendar.YEAR);
                        String an = "/" + String.valueOf(anio);
                        fechaFacturaTxt.setText(fechaFacturaTxt.getText() + an);
                        fechaTxt.requestFocus();
                    } else {
                        if (largo != 10) {
                            JOptionPane.showMessageDialog(this, "Error en fecha");
                            fechaFacturaTxt.setText("");
                            fechaFacturaTxt.requestFocus();
                        } else {
                            String veinte = fechaFacturaTxt.getText().substring(6, 8);
                            if (!veinte.equals("20")) {
                                JOptionPane.showMessageDialog(this, "Error en AÃO");
                                fechaFacturaTxt.requestFocus();
                            } else {
                                fechaTxt.requestFocus();
                            }
                        }
                    }
                }
            }

        }
    }//GEN-LAST:event_fechaFacturaTxtKeyPressed

    private void comboLetraFacturaKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_comboLetraFacturaKeyPressed
        if (evt.getKeyCode() == 10) {
            int row = comboLetraFactura.getSelectedIndex();
            if (row < 1) {
                JOptionPane.showMessageDialog(this, "Debe seleccionar una letra");
                comboLetraFactura.requestFocus();
                return;
            }
            String cui = proveedorSeleccionado.getCuit().substring(0, 6);
            int x_row = comboLetraFactura.getSelectedIndex();
            if (x_row < 4) {
                if (cui.equals("11-111")) {
                    JOptionPane.showMessageDialog(this, "El proveedor no tiene un cuit vÃ¡lido");
                    return;
                }
            }
            nroSucursalTxt.requestFocus();
        }
    }//GEN-LAST:event_comboLetraFacturaKeyPressed

    private void nroSucursalTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_nroSucursalTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            nroFacturTxt.requestFocus();
        }
    }//GEN-LAST:event_nroSucursalTxtKeyPressed

    private void nroFacturTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_nroFacturTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            int row = comboLetraFactura.getSelectedIndex();
            if (row == 1 || row == 3) {
                gravadoTxt.setEditable(true);
                noGravadoTxt.setEditable(false);
                impuestoInternoTxt.setEditable(true);
                percepcionIIBBTxt.setEditable(true);
                percepcionIvaTxt.setEditable(true);
                otroTxt.setEditable(true);
                ivaTxt.setEditable(true);
                totalTxt.setEditable(true);
                //gravadoTxt.requestFocus();
            } else {
                gravadoTxt.setEditable(false);
                noGravadoTxt.setEditable(true);
                impuestoInternoTxt.setEditable(false);
                percepcionIIBBTxt.setEditable(false);
                percepcionIvaTxt.setEditable(false);
                otroTxt.setEditable(true);
                ivaTxt.setEditable(false);
                totalTxt.setEditable(true);
                //noGravadoTxt.requestFocus();
            }
            llevaDetalleChk.requestFocus();
        }
    }//GEN-LAST:event_nroFacturTxtKeyPressed

    private void gravadoTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_gravadoTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            impuestoInternoTxt.requestFocus();
        }
    }//GEN-LAST:event_gravadoTxtKeyPressed

    private void noGravadoTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_noGravadoTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            otroTxt.requestFocus();
        }
    }//GEN-LAST:event_noGravadoTxtKeyPressed

    private void otroTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_otroTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            calcularTotales();
            ivaTxt.requestFocus();
        }
    }//GEN-LAST:event_otroTxtKeyPressed

    private void impuestoInternoTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_impuestoInternoTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            percepcionIIBBTxt.requestFocus();
        }
    }//GEN-LAST:event_impuestoInternoTxtKeyPressed

    private void percepcionIIBBTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_percepcionIIBBTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            percepcionIvaTxt.requestFocus();
        }
    }//GEN-LAST:event_percepcionIIBBTxtKeyPressed

    private void percepcionIvaTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_percepcionIvaTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            otroTxt.requestFocus();
        }
    }//GEN-LAST:event_percepcionIvaTxtKeyPressed

    private void totalTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_totalTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            //guardarBtn.setEnabled(false);
            guardar();
        }
    }//GEN-LAST:event_totalTxtKeyPressed

    private void ivaTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_ivaTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            calcularTotales2();
            totalTxt.requestFocus();
        }
    }//GEN-LAST:event_ivaTxtKeyPressed

    private void comboPeriodosKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_comboPeriodosKeyPressed
        if (evt.getKeyCode() == 10) {
            if (comboPeriodos.getSelectedIndex() > 0) {
                fechaFacturaTxt.requestFocus();
            }
        }
    }//GEN-LAST:event_comboPeriodosKeyPressed

    private void notaDebitoChkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_notaDebitoChkActionPerformed
        llevaDetalleChk.setSelected(false);
        facturaChk.setSelected(false);
        notaCreditoChk.setSelected(false);
        notaDebitoChk.setSelected(true);
        detalleNo();
        fechaTxt.requestFocus();
    }//GEN-LAST:event_notaDebitoChkActionPerformed

    private void llevaDetalleChkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_llevaDetalleChkActionPerformed
        if (llevaDetalleChk.isSelected()) {
            detalleSi();
            llevaStockChk.setSelected(false);
            notaCreditoChk.setSelected(true);
            facturaChk.setSelected(false);
            notaDebitoChk.setSelected(false);
            prontoPagoChk.requestFocus();
        } else {
            detalleNo();
            int row = comboLetraFactura.getSelectedIndex();
            if (row == 1 || row == 3) {
                gravadoTxt.setEditable(true);
                noGravadoTxt.setEditable(false);
                impuestoInternoTxt.setEditable(true);
                percepcionIIBBTxt.setEditable(true);
                percepcionIvaTxt.setEditable(true);
                otroTxt.setEditable(true);
                ivaTxt.setEditable(true);
                totalTxt.setEditable(true);
                prontoPagoChk.requestFocus();
            } else {
                gravadoTxt.setEditable(false);
                noGravadoTxt.setEditable(true);
                impuestoInternoTxt.setEditable(false);
                percepcionIIBBTxt.setEditable(false);
                percepcionIvaTxt.setEditable(false);
                otroTxt.setEditable(true);
                ivaTxt.setEditable(false);
                totalTxt.setEditable(true);
                prontoPagoChk.requestFocus();
            }
        }
    }//GEN-LAST:event_llevaDetalleChkActionPerformed

    private void llevaStockChkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_llevaStockChkActionPerformed
        if (llevaStockChk.isSelected()) {
            if (llevaDetalleChk.isSelected()) {
                llevaStockChk.setSelected(false);
            }
            //detalleNo();
        }
    }//GEN-LAST:event_llevaStockChkActionPerformed

    private void detalle1TxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_detalle1TxtKeyPressed
        if (evt.getKeyCode() == 10) {
            detalle2Txt.requestFocus();
        }
    }//GEN-LAST:event_detalle1TxtKeyPressed

    private void detalle2TxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_detalle2TxtKeyPressed
        if (evt.getKeyCode() == 10) {
            detalle3Txt.requestFocus();
        }
    }//GEN-LAST:event_detalle2TxtKeyPressed

    private void detalle3TxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_detalle3TxtKeyPressed
        if (evt.getKeyCode() == 10) {
            detalle4Txt.requestFocus();
        }
    }//GEN-LAST:event_detalle3TxtKeyPressed

    private void detalle4TxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_detalle4TxtKeyPressed
        if (evt.getKeyCode() == 10) {
            noGravadoTxt.requestFocus();
        }
    }//GEN-LAST:event_detalle4TxtKeyPressed

    private void llevaDetalleChkKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_llevaDetalleChkKeyPressed
        if (evt.getKeyCode() == 10) {
            if (llevaDetalleChk.isSelected()) {
                detalleSi();
                llevaStockChk.setSelected(false);
                notaCreditoChk.setSelected(true);
                facturaChk.setSelected(false);
                notaDebitoChk.setSelected(false);
                prontoPagoChk.requestFocus();
            } else {
                detalleNo();
                int row = comboLetraFactura.getSelectedIndex();
                if (row == 1 || row == 3) {
                    gravadoTxt.setEditable(true);
                    noGravadoTxt.setEditable(false);
                    impuestoInternoTxt.setEditable(true);
                    percepcionIIBBTxt.setEditable(true);
                    percepcionIvaTxt.setEditable(true);
                    otroTxt.setEditable(true);
                    ivaTxt.setEditable(true);
                    totalTxt.setEditable(true);
                    prontoPagoChk.requestFocus();
                } else {
                    gravadoTxt.setEditable(false);
                    noGravadoTxt.setEditable(true);
                    impuestoInternoTxt.setEditable(false);
                    percepcionIIBBTxt.setEditable(false);
                    percepcionIvaTxt.setEditable(false);
                    otroTxt.setEditable(true);
                    ivaTxt.setEditable(false);
                    totalTxt.setEditable(true);
                    prontoPagoChk.requestFocus();
                }
            }
        } else {
            if (evt.getKeyCode() == 32) {
                llevaDetalleChk.setSelected(false);
                detalleSi();
                llevaStockChk.setSelected(false);
                notaCreditoChk.setSelected(true);
                facturaChk.setSelected(false);
                notaDebitoChk.setSelected(false);
                prontoPagoChk.requestFocus();
                int row = comboLetraFactura.getSelectedIndex();
                if (row == 1 || row == 3) {
                    gravadoTxt.setEditable(true);
                    noGravadoTxt.setEditable(false);
                    impuestoInternoTxt.setEditable(true);
                    percepcionIIBBTxt.setEditable(true);
                    percepcionIvaTxt.setEditable(true);
                    otroTxt.setEditable(true);
                    ivaTxt.setEditable(true);
                    totalTxt.setEditable(true);
                    prontoPagoChk.requestFocus();
                } else {
                    gravadoTxt.setEditable(false);
                    noGravadoTxt.setEditable(true);
                    impuestoInternoTxt.setEditable(false);
                    percepcionIIBBTxt.setEditable(false);
                    percepcionIvaTxt.setEditable(false);
                    otroTxt.setEditable(true);
                    ivaTxt.setEditable(false);
                    totalTxt.setEditable(true);
                    prontoPagoChk.requestFocus();
                }
            }
        }
    }//GEN-LAST:event_llevaDetalleChkKeyPressed

    private void fechaTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_fechaTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            if (fechaTxt.getText().isEmpty()) {
                fechaTxt.setText(sdf.format(new Date()));
                fechaTxt.requestFocus();
            } else {
                notaCreditoChk.setEnabled(true);
                int largo = fechaTxt.getText().length();
                if (largo == 2) {
                    Calendar cal = Calendar.getInstance();
                    int mes = cal.get(Calendar.MONTH) + 1;
                    int anio = cal.get(Calendar.YEAR);
                    String an = String.valueOf(anio);
                    String f = "0" + String.valueOf(mes);
                    if (f.length() > 2) {
                        f = f.substring(1, 3);
                    }
                    f = f + "/" + an;
                    fechaTxt.setText(fechaTxt.getText() + "/" + f);
                    diasTxt.requestFocus();
                } else {
                    if (largo == 5) {
                        Calendar cal = Calendar.getInstance();
                        int anio = cal.get(Calendar.YEAR);
                        String an = "/" + String.valueOf(anio);
                        fechaTxt.setText(fechaTxt.getText() + an);
                        diasTxt.requestFocus();
                    } else {
                        if (largo != 10) {
                            JOptionPane.showMessageDialog(this, "Error en fecha");
                            fechaTxt.setText("");
                            fechaTxt.requestFocus();
                        } else {
                            String veinte = fechaTxt.getText().substring(6, 8);
                            if (!veinte.equals("20")) {
                                JOptionPane.showMessageDialog(this, "Error en AÃO");
                                fechaTxt.requestFocus();
                            } else {
                                diasTxt.requestFocus();
                            }
                        }
                    }
                }
            }

        }
    }//GEN-LAST:event_fechaTxtKeyPressed

    private void prontoPagoChkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_prontoPagoChkActionPerformed
        if (llevaDetalleChk.isSelected()) {
            detalleSi();
            llevaStockChk.setSelected(false);
            notaCreditoChk.setSelected(true);
            facturaChk.setSelected(false);
            notaDebitoChk.setSelected(false);
            detalle1Txt.requestFocus();
        } else {
            detalleNo();
            int row = comboLetraFactura.getSelectedIndex();
            if (row == 1 || row == 3) {
                gravadoTxt.setEditable(true);
                noGravadoTxt.setEditable(false);
                impuestoInternoTxt.setEditable(true);
                percepcionIIBBTxt.setEditable(true);
                percepcionIvaTxt.setEditable(true);
                otroTxt.setEditable(true);
                ivaTxt.setEditable(true);
                totalTxt.setEditable(true);
                gravadoTxt.requestFocus();
            } else {
                gravadoTxt.setEditable(false);
                noGravadoTxt.setEditable(true);
                impuestoInternoTxt.setEditable(false);
                percepcionIIBBTxt.setEditable(false);
                percepcionIvaTxt.setEditable(false);
                otroTxt.setEditable(true);
                ivaTxt.setEditable(false);
                totalTxt.setEditable(true);
                noGravadoTxt.requestFocus();
            }
        }
    }//GEN-LAST:event_prontoPagoChkActionPerformed

    private void prontoPagoChkKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_prontoPagoChkKeyPressed
        if (evt.getKeyCode() == 10) {
            if (llevaDetalleChk.isSelected()) {
                detalleSi();
                llevaStockChk.setSelected(false);
                notaCreditoChk.setSelected(true);
                facturaChk.setSelected(false);
                notaDebitoChk.setSelected(false);
                detalle1Txt.requestFocus();
            } else {
                detalleNo();
                int row = comboLetraFactura.getSelectedIndex();
                if (row == 1 || row == 3) {
                    gravadoTxt.setEditable(true);
                    noGravadoTxt.setEditable(false);
                    impuestoInternoTxt.setEditable(true);
                    percepcionIIBBTxt.setEditable(true);
                    percepcionIvaTxt.setEditable(true);
                    otroTxt.setEditable(true);
                    ivaTxt.setEditable(true);
                    totalTxt.setEditable(true);
                    gravadoTxt.requestFocus();
                } else {
                    gravadoTxt.setEditable(false);
                    noGravadoTxt.setEditable(true);
                    impuestoInternoTxt.setEditable(false);
                    percepcionIIBBTxt.setEditable(false);
                    percepcionIvaTxt.setEditable(false);
                    otroTxt.setEditable(true);
                    ivaTxt.setEditable(false);
                    totalTxt.setEditable(true);
                    noGravadoTxt.requestFocus();
                }
            }
        }
    }//GEN-LAST:event_prontoPagoChkKeyPressed

    private void diasTxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_diasTxtKeyPressed
        if (evt.getKeyCode() == 10) {
            if (!diasTxt.getText().isEmpty()) {
                Date fechaCalculo2 = new Date();
                try {
                    fechaCalculo2 = sdf.parse(fechaTxt.getText());
                } catch (ParseException ex) {
                    Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
                    JOptionPane.showMessageDialog(this, "ERR 1207");
                    return;
                }
                Integer dias = Integer.valueOf(diasTxt.getText());
                if (fechaCalculo2 != null) {
                    Calendar cal = Calendar.getInstance();
                    cal.setTime(fechaCalculo2);
                    cal.add(Calendar.DATE, dias);
                    Date fech = cal.getTime();
                    fechaCalculoVencimientoTxt.setText(sdf.format(fech));
//                    comprobante.setDiasVencimiento(dias);
//                    comprobante.setFechaCalculoVencimiento(fech);
                }
                comboLetraFactura.requestFocus();
            }
        }
    }//GEN-LAST:event_diasTxtKeyPressed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new NuevoComprobanteComprasFrame(null, null, 0).setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton buscarProveedorBtn;
    private javax.swing.JButton chekBtn;
    private javax.swing.JTextField codigoProveedorTxt;
    private javax.swing.JComboBox comboLetraFactura;
    private javax.swing.JComboBox<String> comboPeriodos;
    private javax.swing.JComboBox comboProveedor;
    private javax.swing.JTextField detalle1Txt;
    private javax.swing.JTextField detalle2Txt;
    private javax.swing.JTextField detalle3Txt;
    private javax.swing.JTextField detalle4Txt;
    private javax.swing.JTextField diasTxt;
    private javax.swing.JRadioButton facturaChk;
    private javax.swing.JTextField fechaCalculoVencimientoTxt;
    private javax.swing.JTextField fechaFacturaTxt;
    private javax.swing.JTextField fechaTxt;
    private javax.swing.JTextField filtroTxt;
    private javax.swing.JTextField gravadoTxt;
    private javax.swing.JButton guardarBtn;
    private javax.swing.JCheckBox impresionChk;
    private javax.swing.JTextField impuestoInternoTxt;
    private javax.swing.JTextField ivaTxt;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JCheckBox llevaDetalleChk;
    private javax.swing.JCheckBox llevaStockChk;
    private javax.swing.JTextField noGravadoTxt;
    private javax.swing.JRadioButton notaCreditoChk;
    private javax.swing.JRadioButton notaDebitoChk;
    private javax.swing.JTextField nroFacturTxt;
    private javax.swing.JTextField nroSucursalTxt;
    private javax.swing.JTextField otroTxt;
    private javax.swing.JTextField percepcionIIBBTxt;
    private javax.swing.JTextField percepcionIvaTxt;
    private javax.swing.JCheckBox prontoPagoChk;
    private javax.swing.JTextField razonSocialProveedorBuscadoTxt;
    private javax.swing.JTextField totalTxt;
    private javax.swing.JButton volverBtn;
    // End of variables declaration//GEN-END:variables

    private void guardar() {
        if (validar()) {
            int a = JOptionPane.showConfirmDialog(this, "Confirma Guardar el Comprobante?",
                    "AtenciÃ³n", JOptionPane.YES_NO_OPTION);
            if (a == 0) {
                Date ff = new Date();
                Date fv = new Date();
                try {
                    ff = sdf.parse(fechaFacturaTxt.getText());
                    fv = sdf.parse(fechaTxt.getText());
                } catch (ParseException ex) {
                    JOptionPane.showMessageDialog(this, "Error en fecha Factura o Entrega");
                    fechaFacturaTxt.requestFocus();
                    //Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
                    return;
                }
                Date hoy = new Date();
                String veinte = fechaFacturaTxt.getText().substring(6, 8);
                if (!veinte.equals("20")) {
                    JOptionPane.showMessageDialog(this, "Error en fecha - AÃO");
                    fechaFacturaTxt.requestFocus();
                    return;
                }
                veinte = fechaTxt.getText().substring(6, 8);
                if (!veinte.equals("20")) {
                    JOptionPane.showMessageDialog(this, "Error en fecha - AÃO");
                    fechaTxt.requestFocus();
                    return;
                }
                if (ff.after(hoy)) {
                    JOptionPane.showMessageDialog(this, "Error fecha posterior a HOY");
                    fechaFacturaTxt.requestFocus();
                    return;
                }
                if (fv.after(hoy)) {
                    JOptionPane.showMessageDialog(this, "Error fecha posterior a HOY");
                    fechaTxt.requestFocus();
                    return;
                }
                comprobante = null;
                comprobante = new ComprobanteCompras();
                SeguimientoCompras sc = new SeguimientoCompras();
                List<ComprobanteComprasDetalle> ccd = new ArrayList<ComprobanteComprasDetalle>();
                CuentaCorrienteProveedor ccp = new CuentaCorrienteProveedor();
                IvaCompras ic = new IvaCompras();
                comprobante.setFechaFactura(ff);
                comprobante.setFechaEntrega(fv);
                if (prontoPagoChk.isSelected()) {
                    comprobante.setProntoPago(true);
                } else {
                    comprobante.setProntoPago(false);
                }
                int row = comboPeriodos.getSelectedIndex();
                Date fp = periodos.get(row - 1).getDesdeFecha();
                comprobante.setFechaPeriodo(fp);
                comprobante.setProveedor(proveedorSeleccionado);
                comprobante.setLetra(comboLetraFactura.getSelectedItem().toString());
                int letraComp = comboLetraFactura.getSelectedIndex();
                if (nroSucursalTxt.getText().isEmpty()) {
                    comprobante.setNumeroSucursal(0);
                } else {
                    comprobante.setNumeroSucursal(Integer.valueOf(nroSucursalTxt.getText()));
                }
                comprobante.setNumeroFactura(Integer.valueOf(nroFacturTxt.getText()));
                if (noGravadoTxt.getText().isEmpty()) {
                    noGravado = 0.00;
                } else {
                    noGravado = Double.valueOf(noGravadoTxt.getText().replace(",", "."));
                }
                comprobante.setNoGravado(noGravado);
                if (gravadoTxt.getText().isEmpty()) {
                    gravado = 0.00;
                } else {
                    gravado = Double.valueOf(gravadoTxt.getText().replace(",", "."));
                }
                comprobante.setGravado(gravado);
                if (letraComp < 4) {
                    comprobante.setEnLibro(true);
                } else {
                    comprobante.setEnLibro(false);
                }
                if (impuestoInternoTxt.getText().isEmpty()) {
                    impuestoInterno = 0.00;
                } else {
                    impuestoInterno = Double.valueOf(impuestoInternoTxt.getText().replace(",", "."));
                }
                comprobante.setImpuestoInterno(impuestoInterno);
                if (otroTxt.getText().isEmpty()) {
                    otro = 0.00;
                } else {
                    otro = Double.valueOf(otroTxt.getText().replace(",", "."));
                }
                comprobante.setOtro(otro);
                if (percepcionIIBBTxt.getText().isEmpty()) {
                    percepcionIIBB = 0.00;
                } else {
                    percepcionIIBB = Double.valueOf(percepcionIIBBTxt.getText().replace(",", "."));
                }
                comprobante.setPercepcionIiBb(percepcionIIBB);
                if (percepcionIvaTxt.getText().isEmpty()) {
                    percepcionIva = 0.00;
                } else {
                    percepcionIva = Double.valueOf(percepcionIvaTxt.getText().replace(",", "."));
                }
                comprobante.setPercepcionIva(percepcionIva);
                if (totalTxt.getText().isEmpty()) {
                    JOptionPane.showMessageDialog(this, "ERROR NO PUEDE GRABAR UN COMPROBANTE EN CERO");
                    return;
                } else {
                    importeTotal = Double.valueOf(totalTxt.getText().replace(",", "."));
                }
                comprobante.setTotal(importeTotal);
                if (ivaTxt.getText().isEmpty()) {
                    importeIva = 0.00;
                } else {
                    importeIva = Double.valueOf(ivaTxt.getText().replace(",", "."));
                }
                comprobante.setIva(importeIva);
                if (facturaChk.isSelected()) {
                    comprobante.setEsDebito(true);
                    comprobante.setTipoComprobante("FC");
                } else {
                    if (notaDebitoChk.isSelected()) {
                        comprobante.setEsDebito(true);
                        comprobante.setTipoComprobante("ND");
                    } else {
                        comprobante.setEsDebito(false);
                        comprobante.setTipoComprobante("NC");
                    }
                }
                comprobante.setEstaPago(false);
                if (!diasTxt.getText().isEmpty()) {
                    Integer dias = Integer.valueOf(diasTxt.getText());
                    if (comprobante.getFechaEntrega() != null) {
                        Calendar cal = Calendar.getInstance();
                        cal.setTime(comprobante.getFechaEntrega());
                        cal.add(Calendar.DATE, dias);
                        Date fech = cal.getTime();
                        fechaCalculoVencimientoTxt.setText(sdf.format(fech));
                        comprobante.setDiasVencimiento(dias);
                        comprobante.setFechaCalculoVencimiento(fech);
                    }
                }
                comprobante.setPagado(0.0);
                if (llevaDetalleChk.isSelected()) {
                    comprobante.setTieneDetalle(true);
                } else {
                    comprobante.setTieneDetalle(false);
                }
                if (proveedorSeleccionado.getStock()) {
                    sc.setComprobante(comprobante);
                    if (llevaStockChk.isSelected()) {
                        sc.setLlevaStock(true);
                    } else {
                        sc.setLlevaStock(false);
                    }
                    sc.setFecha(ff);
                    sc.setPago(false);
                    sc.setStock(false);
                } else {
                    sc = null;
                }
                if (llevaDetalleChk.isSelected()) {
                    if (!detalle1Txt.getText().isEmpty()) {
                        ComprobanteComprasDetalle ccd0 = new ComprobanteComprasDetalle();
                        ccd0.setOrden(0);
                        ccd0.setComprobanteCompras(comprobante);
                        ccd0.setTexto(detalle1Txt.getText());
                        ccd.add(ccd0);
                    }
                    if (!detalle2Txt.getText().isEmpty()) {
                        ComprobanteComprasDetalle ccd0 = new ComprobanteComprasDetalle();
                        ccd0.setOrden(1);
                        ccd0.setComprobanteCompras(comprobante);
                        ccd0.setTexto(detalle2Txt.getText());
                        ccd.add(ccd0);
                    }
                    if (!detalle3Txt.getText().isEmpty()) {
                        ComprobanteComprasDetalle ccd0 = new ComprobanteComprasDetalle();
                        ccd0.setOrden(2);
                        ccd0.setComprobanteCompras(comprobante);
                        ccd0.setTexto(detalle3Txt.getText());
                        ccd.add(ccd0);
                    }
                    if (!detalle4Txt.getText().isEmpty()) {
                        ComprobanteComprasDetalle ccd0 = new ComprobanteComprasDetalle();
                        ccd0.setOrden(3);
                        ccd0.setComprobanteCompras(comprobante);
                        ccd0.setTexto(detalle4Txt.getText());
                        ccd.add(ccd0);
                    }
                }
                Double s;
                if (proveedorSeleccionado.getSaldo() != null) {
                    s = proveedorSeleccionado.getSaldo();
                } else {
                    s = 0.0;
                }
                if (facturaChk.isSelected()) {
                    s += importeTotal;
                } else {
                    if (notaDebitoChk.isSelected()) {
                        s += importeTotal;
                    } else {
                        s -= importeTotal;
                    }
                }
                System.out.println(proveedorSeleccionado.getSaldo());
                proveedorSeleccionado.setSaldo(s);
                ccp.setComprobante(comprobante);
                ccp.setFecha(comprobante.getFechaFactura());
                if (facturaChk.isSelected()) {
                    ccp.setDebe(importeTotal);
                    ccp.setHaber(0.00);
                    ccp.setSaldo(importeTotal);
                } else {
                    if (notaDebitoChk.isSelected()) {
                        ccp.setDebe(importeTotal);
                        ccp.setHaber(0.00);
                        ccp.setSaldo(importeTotal);
                    } else {
                        ccp.setDebe(0.00);
                        ccp.setHaber(importeTotal);
                        ccp.setSaldo(-importeTotal);
                    }
                }
                ccp.setProveedor(proveedorSeleccionado);
                ccp.setReciboProveedor(null);
                Calendar cal = Calendar.getInstance();
                cal.setTime(comprobante.getFechaFactura());
                cal.add(Calendar.DATE, -365);
                Date fecha1 = cal.getTime();
                Date fecha2 = new Date();
//                List<CuentaCorrienteProveedor> ctap = null;
//                try {
//                    ctap = new CuentaCorrienteProveedorService().getCtaCteProvByProvMasFechas(proveedorSeleccionado, fecha1, fecha2);
//                } catch (Exception ex) {
//                    Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                    return;
//                }
//                Double sa = 0.0;
//                int x = 0;
//                if (ctap != null && !ctap.isEmpty()) {
//                    for (CuentaCorrienteProveedor cc1 : ctap) {
//                        if (x == 0) {
//                            sa = cc1.getSaldo();
//                            x = 1;
//                        } else {
//                            sa += (cc1.getDebe() - cc1.getHaber());
//                            cc1.setSaldo(sa);
////                            try {
////                                new CuentaCorrienteProveedorService().updateCtaCteProveedor(cc1);
////                            } catch (Exception ex) {
////                                Logger.getLogger(IngresarPagoFrame.class.getName()).log(Level.SEVERE, null, ex);
////                                return;
////                            }
//                        }
//                    }
//                }
                if (letraComp < 4) { // comprobante en libro iva compras
                    ic.setFechaFactura(comprobante.getFechaFactura());
                    ic.setFechaPeriodo(comprobante.getFechaPeriodo());
                    ic.setGravado(gravado);
                    ic.setImpuestoInterno(impuestoInterno);
                    ic.setIva(importeIva);
                    ic.setLetra(comprobante.getLetra());
                    ic.setNoGravado(noGravado);
                    ic.setNumeroFactura(comprobante.getNumeroFactura());
                    ic.setNumeroSucursal(comprobante.getNumeroSucursal());
                    ic.setOtro(otro);
                    ic.setPercepcionIiBb(percepcionIIBB);
                    ic.setPercepcionIva(percepcionIva);
                    ic.setProveedor(proveedorSeleccionado);
                    ic.setTotal(importeTotal);
                    ic.setComprobante(comprobante);
                    if (facturaChk.isSelected()) {
                        ic.setCredito(false);
                    } else {
                        if (notaDebitoChk.isSelected()) {
                            ic.setCredito(false);
                        } else {
                            ic.setCredito(true);
                        }
                    }
                } else {
                    ic = null;
                }
                System.out.println(s);
                System.out.println(proveedorSeleccionado.getSaldo());
//                JOptionPane.showMessageDialog(this, s);
                try {
                    new ComprobanteComprasService().saveComprobanteCompleto(comprobante, sc, ccd, proveedorSeleccionado, ccp, ic, fecha1, fecha2);
                } catch (Exception ex) {
                    Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
                }
                if (llevaDetalleChk.isSelected()) {
                    if (impresionChk.isSelected()) {
                        PrinterJob pj = PrinterJob.getPrinterJob();
                        PageFormat pf = pj.defaultPage();
                        Paper paper = new Paper();
                        double margin = 8;
                        paper.setImageableArea(margin, margin, paper.getWidth() - margin * 2, paper.getHeight() - margin * 2);
                        pf.setPaper(paper);
                        pj.setPrintable(new MyPrintable(), pf);
//        if (pj.printDialog()) {
                        try {
                            pj.print();
                        } catch (PrinterException e) {
                            System.out.println(e);
                        }
                    }
                }
                limpiarCampos();
                comprobante = null;
            }
        }
        codigoProveedorTxt.requestFocus();
    }

    private void guardar3() {
//        if (validar()) {
//            int modifica = 1;
//            comprobante = null;
//            comprobante = new ComprobanteCompras();
//            Date ff = new Date();
//            Date fv = new Date();
//            try {
//                ff = sdf.parse(fechaFacturaTxt.getText());
//                fv = sdf.parse(fechaTxt.getText());
//            } catch (ParseException ex) {
//                JOptionPane.showMessageDialog(this, "Error en fecha Factura o Entrega");
//                fechaFacturaTxt.requestFocus();
//                //Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                return;
//            }
//            Date hoy = new Date();
//            String veinte = fechaFacturaTxt.getText().substring(6, 8);
//            if (!veinte.equals("20")) {
//                JOptionPane.showMessageDialog(this, "Error en fecha - AÃO");
//                fechaFacturaTxt.requestFocus();
//                return;
//            }
//            veinte = fechaTxt.getText().substring(6, 8);
//            if (!veinte.equals("20")) {
//                JOptionPane.showMessageDialog(this, "Error en fecha - AÃO");
//                fechaTxt.requestFocus();
//                return;
//            }
//            if (ff.after(hoy)) {
//                JOptionPane.showMessageDialog(this, "Error fecha posterior a HOY");
//                fechaFacturaTxt.requestFocus();
//                return;
//            }
//            if (fv.after(hoy)) {
//                JOptionPane.showMessageDialog(this, "Error fecha posterior a HOY");
//                fechaTxt.requestFocus();
//                return;
//            }
//            comprobante.setFechaFactura(ff);
//            comprobante.setFechaEntrega(fv);
//            if (prontoPagoChk.isSelected()) {
//                comprobante.setProntoPago(true);
//            } else {
//                comprobante.setProntoPago(false);
//            }
//            int row = comboPeriodos.getSelectedIndex();
//            Date fp = periodos.get(row - 1).getDesdeFecha();
//            comprobante.setFechaPeriodo(fp);
//            comprobante.setProveedor(proveedorSeleccionado);
//            comprobante.setLetra(comboLetraFactura.getSelectedItem().toString());
//            int letraComp = comboLetraFactura.getSelectedIndex();
//            if (nroSucursalTxt.getText().isEmpty()) {
//                comprobante.setNumeroSucursal(0);
//            } else {
//                comprobante.setNumeroSucursal(Integer.valueOf(nroSucursalTxt.getText()));
//            }
//            comprobante.setNumeroFactura(Integer.valueOf(nroFacturTxt.getText()));
//            if (noGravadoTxt.getText().isEmpty()) {
//                noGravado = 0.00;
//            } else {
//                noGravado = Double.valueOf(noGravadoTxt.getText().replace(",", "."));
//            }
//            comprobante.setNoGravado(noGravado);
//            if (gravadoTxt.getText().isEmpty()) {
//                gravado = 0.00;
//            } else {
//                gravado = Double.valueOf(gravadoTxt.getText().replace(",", "."));
//            }
//            comprobante.setGravado(gravado);
//            if (modifica == 1) {
//                if (letraComp < 4) {
//                    comprobante.setEnLibro(true);
//                } else {
//                    comprobante.setEnLibro(false);
//                }
//            }
//            if (impuestoInternoTxt.getText().isEmpty()) {
//                impuestoInterno = 0.00;
//            } else {
//                impuestoInterno = Double.valueOf(impuestoInternoTxt.getText().replace(",", "."));
//            }
//            comprobante.setImpuestoInterno(impuestoInterno);
//            if (otroTxt.getText().isEmpty()) {
//                otro = 0.00;
//            } else {
//                otro = Double.valueOf(otroTxt.getText().replace(",", "."));
//            }
//            comprobante.setOtro(otro);
//            if (percepcionIIBBTxt.getText().isEmpty()) {
//                percepcionIIBB = 0.00;
//            } else {
//                percepcionIIBB = Double.valueOf(percepcionIIBBTxt.getText().replace(",", "."));
//            }
//            comprobante.setPercepcionIiBb(percepcionIIBB);
//            if (percepcionIvaTxt.getText().isEmpty()) {
//                percepcionIva = 0.00;
//            } else {
//                percepcionIva = Double.valueOf(percepcionIvaTxt.getText().replace(",", "."));
//            }
//            comprobante.setPercepcionIva(percepcionIva);
//            if (totalTxt.getText().isEmpty()) {
//                importeTotal = 0.00;
//            } else {
//                importeTotal = Double.valueOf(totalTxt.getText().replace(",", "."));
//            }
//            comprobante.setTotal(importeTotal);
//            if (ivaTxt.getText().isEmpty()) {
//                importeIva = 0.00;
//            } else {
//                importeIva = Double.valueOf(ivaTxt.getText().replace(",", "."));
//            }
//            comprobante.setIva(importeIva);
//            if (facturaChk.isSelected()) {
//                comprobante.setEsDebito(true);
//                comprobante.setTipoComprobante("FC");
//            } else {
//                if (notaDebitoChk.isSelected()) {
//                    comprobante.setEsDebito(true);
//                    comprobante.setTipoComprobante("ND");
//                } else {
//                    comprobante.setEsDebito(false);
//                    comprobante.setTipoComprobante("NC");
//                }
//            }
//            comprobante.setEstaPago(false);
//            comprobante.setPagado(0.0);
//            if (llevaDetalleChk.isSelected()) {
//                comprobante.setTieneDetalle(true);
//            } else {
//                comprobante.setTieneDetalle(false);
//            }
//            int a = JOptionPane.showConfirmDialog(this, "Confirma Guardar el Comprobante?",
//                    "AtenciÃ³n", JOptionPane.YES_NO_OPTION);
//            if (a != 0) {
//                return;
//            }
        //guardarBtn.setEnabled(false);
//            if (modifica == 1) { // es nuevo comprobante
//            try {
//                comprobante = new ComprobanteComprasService().saveComprobante(comprobante);
//                JOptionPane.showMessageDialog(this, "Comprobante GRABADO correctamente");
//            } catch (Exception ex) {
//                JOptionPane.showMessageDialog(this, "No se pudo GRABAR comprobante");
//                Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                return;
//            }
//            if (proveedorSeleccionado.getStock()) {
//                SeguimientoCompras sc = new SeguimientoCompras();
//                sc.setComprobante(comprobante);
//                if (llevaStockChk.isSelected()) {
//                    sc.setLlevaStock(true);
//                } else {
//                    sc.setLlevaStock(false);
//                }
//                sc.setFecha(ff);
//                sc.setPago(false);
//                sc.setStock(false);
//                try {
//                    new SeguimientoComprasService().saveSeguimientoCompras(sc);
//                } catch (Exception ex) {
//                    Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                    return;
//                }
//            }
//            if (llevaDetalleChk.isSelected()) {
//                ComprobanteComprasDetalle ccd = new ComprobanteComprasDetalle();
//                if (!detalle1Txt.getText().isEmpty()) {
//                    ccd.setOrden(0);
//                    ccd.setComprobanteCompras(comprobante);
//                    ccd.setTexto(detalle1Txt.getText());
//                    try {
//                        new ComprobanteComprasDetalleService().saveComprobanteDetalle(ccd);
//                    } catch (Exception ex) {
//                        Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                    }
//                }
//                ccd = new ComprobanteComprasDetalle();
//                if (!detalle2Txt.getText().isEmpty()) {
//                    ccd.setOrden(1);
//                    ccd.setComprobanteCompras(comprobante);
//                    ccd.setTexto(detalle2Txt.getText());
//                    try {
//                        new ComprobanteComprasDetalleService().saveComprobanteDetalle(ccd);
//                    } catch (Exception ex) {
//                        Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                    }
//                }
//                ccd = new ComprobanteComprasDetalle();
//                if (!detalle3Txt.getText().isEmpty()) {
//                    ccd.setOrden(2);
//                    ccd.setComprobanteCompras(comprobante);
//                    ccd.setTexto(detalle3Txt.getText());
//                    try {
//                        new ComprobanteComprasDetalleService().saveComprobanteDetalle(ccd);
//                    } catch (Exception ex) {
//                        Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                    }
//                }
//                ccd = new ComprobanteComprasDetalle();
//                if (!detalle4Txt.getText().isEmpty()) {
//                    ccd.setOrden(3);
//                    ccd.setComprobanteCompras(comprobante);
//                    ccd.setTexto(detalle4Txt.getText());
//                    try {
//                        new ComprobanteComprasDetalleService().saveComprobanteDetalle(ccd);
//                    } catch (Exception ex) {
//                        Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                    }
//                }
//            }
//            }
//            Double s = 0.00;
////            if (modifica == 1) { // es nuevo comprobante - Actualiza saldo proveedor
//            if (proveedorSeleccionado.getSaldo() != null) {
//                s = proveedorSeleccionado.getSaldo();
//            }
//            if (facturaChk.isSelected()) {
//                s += importeTotal;
//            } else {
//                if (notaDebitoChk.isSelected()) {
//                    s += importeTotal;
//                } else {
//                    s -= importeTotal;
//                }
//            }
//            proveedorSeleccionado.setSaldo(s);
//            try {
//                new ProveedorService().updateProveedor(proveedorSeleccionado);
//            } catch (Exception ex) {
//                Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                return;
//            }
//            }
//            if (modifica == 1) { // es nuevo comprobante - Nuevo Asiento en Cta Cte
//            CuentaCorrienteProveedor ccp = new CuentaCorrienteProveedor();
//            ccp.setComprobante(comprobante);
//            ccp.setFecha(comprobante.getFechaFactura());
//            if (facturaChk.isSelected()) {
//                ccp.setDebe(importeTotal);
//                ccp.setHaber(0.00);
//                ccp.setSaldo(importeTotal);
//            } else {
//                if (notaDebitoChk.isSelected()) {
//                    ccp.setDebe(importeTotal);
//                    ccp.setHaber(0.00);
//                    ccp.setSaldo(importeTotal);
//                } else {
//                    ccp.setDebe(0.00);
//                    ccp.setHaber(importeTotal);
//                    ccp.setSaldo(-importeTotal);
//                }
//            }
//            ccp.setProveedor(proveedorSeleccionado);
//            ccp.setReciboProveedor(null);
//            try {
//                new CuentaCorrienteProveedorService().saveCtaCteProveedor(ccp);
//            } catch (Exception ex) {
//                Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                return;
//            }
//            }
//            Calendar cal = Calendar.getInstance();
//            cal.setTime(comprobante.getFechaFactura());
//            cal.add(Calendar.DATE, -365);
//            Date fecha1 = cal.getTime();
//            Date fecha2 = new Date();
//            List<CuentaCorrienteProveedor> ctap;
//            try {
//                ctap = new CuentaCorrienteProveedorService().getCtaCteProvByProvMasFechas(proveedorSeleccionado, fecha1, fecha2);
//            } catch (Exception ex) {
//                Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                return;
//            }
//            Double sa = 0.0;
//            int x = 0;
//            if (ctap != null && !ctap.isEmpty()) {
//                for (CuentaCorrienteProveedor cc1 : ctap) {
//                    if (x == 0) {
//                        sa = cc1.getSaldo();
//                        x = 1;
//                    } else {
//                        sa += (cc1.getDebe() - cc1.getHaber());
//                        cc1.setSaldo(sa);
//                        try {
//                            new CuentaCorrienteProveedorService().updateCtaCteProveedor(cc1);
//                        } catch (Exception ex) {
//                            Logger.getLogger(IngresarPagoFrame.class.getName()).log(Level.SEVERE, null, ex);
//                            return;
//                        }
//                    }
//                }
//            }
//            if (modifica == 1) { //es nuevo comprobante
//            if (letraComp < 4) { // comprobante en libro iva compras
//                IvaCompras ic = new IvaCompras();
//                ic.setFechaFactura(comprobante.getFechaFactura());
//                ic.setFechaPeriodo(comprobante.getFechaPeriodo());
//                ic.setGravado(gravado);
//                ic.setImpuestoInterno(impuestoInterno);
//                ic.setIva(importeIva);
//                ic.setLetra(comprobante.getLetra());
//                ic.setNoGravado(noGravado);
//                ic.setNumeroFactura(comprobante.getNumeroFactura());
//                ic.setNumeroSucursal(comprobante.getNumeroSucursal());
//                ic.setOtro(otro);
//                ic.setPercepcionIiBb(percepcionIIBB);
//                ic.setPercepcionIva(percepcionIva);
//                ic.setProveedor(proveedorSeleccionado);
//                ic.setTotal(importeTotal);
//                ic.setComprobante(comprobante);
//                if (facturaChk.isSelected()) {
//                    ic.setCredito(false);
//                } else {
//                    if (notaDebitoChk.isSelected()) {
//                        ic.setCredito(false);
//                    } else {
//                        ic.setCredito(true);
//                    }
//                }
//                try {
//                    new IvaComprasServices().saveIvaCompras(ic);
//                } catch (Exception ex) {
//                    Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
//                    return;
//                }
//                //new ComprobanteComprasService().saveComprobanteCompleto(comprobante, sc);
//            }

//            }
//            if (llevaDetalleChk.isSelected()) {
//                if (impresionChk.isSelected()) {
//                    PrinterJob pj = PrinterJob.getPrinterJob();
//                    PageFormat pf = pj.defaultPage();
//                    Paper paper = new Paper();
//                    double margin = 8;
//                    paper.setImageableArea(margin, margin, paper.getWidth() - margin * 2, paper.getHeight() - margin * 2);
//                    pf.setPaper(paper);
//                    pj.setPrintable(new MyPrintable(), pf);
////        if (pj.printDialog()) {
//                    try {
//                        pj.print();
//                    } catch (PrinterException e) {
//                        System.out.println(e);
//                    }
//                }
//            }
//            limpiarCampos();
//            comprobante = null;
//        }
//        codigoProveedorTxt.requestFocus();
    }

    private void limpiarCampos() {
        fechaTxt.setText("");
        fechaCalculoVencimientoTxt.setText("");
        fechaCalculoVencimientoTxt.setEditable(false);
        diasTxt.setText("");
        prontoPagoChk.setSelected(false);
        fechaFacturaTxt.setText("");
        nroSucursalTxt.setText("");
        nroFacturTxt.setText("");
        filtroTxt.setText("");
        gravadoTxt.setText("");
        noGravadoTxt.setText("");
        impuestoInternoTxt.setText("");
        percepcionIIBBTxt.setText("");
        percepcionIvaTxt.setText("");
        otroTxt.setText("");
        ivaTxt.setText("");
        totalTxt.setText("");
        comboProveedor.removeAllItems();
        razonSocialProveedorBuscadoTxt.setText("");
        codigoProveedorTxt.setText("");
        // aqui se bloquean los campos de importe
        gravadoTxt.setEditable(false);
        noGravadoTxt.setEditable(false);
        impuestoInternoTxt.setEditable(false);
        percepcionIIBBTxt.setEditable(false);
        percepcionIvaTxt.setEditable(false);
        otroTxt.setEditable(false);
        ivaTxt.setEditable(false);
        totalTxt.setEditable(false);
        facturaChk.setSelected(true);
        notaCreditoChk.setSelected(false);
        notaDebitoChk.setSelected(false);
        llevaStockChk.setSelected(true);
        detalleNo();
    }

    private void cargarConfiguracion() {
        try {
            conf = new ConfiguracionService().getFacturas((long) 1);
        } catch (Exception ex) {
            Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
        }
        iva = conf.getIva();
        try {
            periodos = new PeriodoService().getAllPeriodosAbiertos();
        } catch (Exception ex) {
            Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
        }
        comboPeriodos.removeAllItems();
        comboPeriodos.addItem("");
        if (periodos != null && !periodos.isEmpty()) {
            for (Periodo p : periodos) {
                comboPeriodos.addItem(p.getDetalle());
            }
        }
    }

    private void calcularTotales() {
        guardarBtn.setEnabled(true);
        if (!gravadoTxt.getText().isEmpty()) {
            importeIva = Double.valueOf(gravadoTxt.getText().replace(",", ".")) * iva;
            importeIva = rint(importeIva) / 100;
        } else {
            importeIva = 0.0;
        }
        ivaTxt.setText((String.valueOf(df.format(importeIva))).replace(",", "."));
        if (!gravadoTxt.getText().isEmpty()) {
            gravado = Double.valueOf(gravadoTxt.getText().replace(",", "."));
        } else {
            gravado = 0.0;
        }
        if (!noGravadoTxt.getText().isEmpty()) {
            noGravado = Double.valueOf(noGravadoTxt.getText().replace(",", "."));
        } else {
            noGravado = 0.0;
        }
        if (!impuestoInternoTxt.getText().isEmpty()) {
            impuestoInterno = Double.valueOf(impuestoInternoTxt.getText().replace(",", "."));
        } else {
            impuestoInterno = 0.0;
        }
        if (!percepcionIIBBTxt.getText().isEmpty()) {
            percepcionIIBB = Double.valueOf(percepcionIIBBTxt.getText().replace(",", "."));
        } else {
            percepcionIIBB = 0.0;
        }
        if (!percepcionIvaTxt.getText().isEmpty()) {
            percepcionIva = Double.valueOf(percepcionIvaTxt.getText().replace(",", "."));
        } else {
            percepcionIva = 0.0;
        }
        if (!otroTxt.getText().isEmpty()) {
            otro = Double.valueOf(otroTxt.getText().replace(",", "."));
        } else {
            otro = 0.0;
        }
        importeTotal = gravado;
        importeTotal += importeIva;
        importeTotal += noGravado;
        importeTotal += impuestoInterno;
        importeTotal += percepcionIIBB;
        importeTotal += percepcionIva;
        importeTotal += otro;
        totalTxt.setText((df.format(importeTotal)).replace(",", "."));
    }

    private void llenarCampos() {
        proveedorSeleccionado = comprobante.getProveedor();
        comboProveedor.removeAllItems();
        filtroTxt.setText("");
        codigoProveedorTxt.setText(String.valueOf(proveedorSeleccionado.getCodigo()));
        razonSocialProveedorBuscadoTxt.setText(proveedorSeleccionado.getRazonSocial());
        Date da = comprobante.getFechaPeriodo();
        int perio = 1;
        for (Periodo p : periodos) {
            if (da.equals(p.getDesdeFecha())) {
                comboPeriodos.setSelectedIndex(perio);
                break;
            }
            perio += 1;
        }
        fechaFacturaTxt.setText(sdf.format(comprobante.getFechaFactura()));
        if (comprobante.getEsDebito()) {
            notaCreditoChk.setSelected(false);
            if (comprobante.getTipoComprobante().equals("ND")) {
                facturaChk.setSelected(false);
                notaDebitoChk.setSelected(true);
            } else {
                facturaChk.setSelected(true);
                notaDebitoChk.setSelected(false);
            }
        } else {
            facturaChk.setSelected(false);
            notaCreditoChk.setSelected(true);
            notaDebitoChk.setSelected(false);
        }
        if (comprobante.getLetra() != null) {
            if (comprobante.getLetra().equals("")) {
                comboLetraFactura.setSelectedIndex(0);
            } else {
                if (comprobante.getLetra().equals("A")) {
                    comboLetraFactura.setSelectedIndex(1);
                } else {
                    if (comprobante.getLetra().equals("C")) {
                        comboLetraFactura.setSelectedIndex(2);
                    } else {
                        if (comprobante.getLetra().equals("M")) {
                            comboLetraFactura.setSelectedIndex(3);
                        }
                    }
                }
            }
        }
        nroSucursalTxt.setText(String.valueOf(comprobante.getNumeroSucursal()));
        nroFacturTxt.setText(String.valueOf(comprobante.getNumeroFactura()));
        gravadoTxt.setText(df.format(comprobante.getGravado()));
        noGravadoTxt.setText(df.format(comprobante.getNoGravado()));
        impuestoInternoTxt.setText(df.format(comprobante.getImpuestoInterno()));
        percepcionIIBBTxt.setText(df.format(comprobante.getPercepcionIiBb()));
        percepcionIvaTxt.setText(df.format(comprobante.getPercepcionIva()));
        otroTxt.setText(df.format(comprobante.getOtro()));
        ivaTxt.setText(df.format(comprobante.getIva()));
        totalTxt.setText(df.format(comprobante.getTotal()));
        gravadoTxt.setEditable(false);
        noGravadoTxt.setEditable(false);
        impuestoInternoTxt.setEditable(false);
        percepcionIIBBTxt.setEditable(false);
        percepcionIvaTxt.setEditable(false);
        otroTxt.setEditable(false);
        ivaTxt.setEditable(false);
        totalTxt.setEditable(false);
        //fechaPeriodoTxt.requestFocus();
        chekBtn.setEnabled(false);
    }

    private void buscarProvPorCodigo() {
        codigoProveedor = Integer.valueOf(codigoProveedorTxt.getText());
        proveedorSeleccionado = null;
        try {
            proveedorSeleccionado = new ProveedorService().getProveedorByCodigo(codigoProveedor);
            razonSocialProveedorBuscadoTxt.setText(proveedorSeleccionado.getRazonSocial());
            //fechaPeriodoTxt.requestFocus();
        } catch (Exception ex) {
//            Logger.getLogger(NuevoIvaComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
            JOptionPane.showMessageDialog(this, "Debe ingresar un codigo valido");
            codigoProveedorTxt.requestFocus();
            return;
        }
        if (proveedorSeleccionado != null) {
            comboPeriodos.requestFocus();
        } else {
            codigoProveedorTxt.requestFocus();
            return;
        }
    }

    private void buscarProvPorFiltro() {
        filtro = filtroTxt.getText();
        proveedores = null;
        comboProveedor.removeAllItems();
        try {
            proveedores = new ProveedorService().getProveedoresByFiltro(filtro);
        } catch (Exception ex) {
            Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
        }
        if (proveedores != null && !proveedores.isEmpty()) {
            for (Proveedor prov : proveedores) {
                comboProveedor.addItem(prov.getRazonSocial());
            }
        }
        comboProveedor.requestFocus();
    }

    private boolean validar() {
        int row = comboPeriodos.getSelectedIndex();
        String tipoComp = "";
        if (totalTxt.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "Importe en cero");
            totalTxt.requestFocus();
            return false;
        }
        if (fechaTxt.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "DEBE INGRESAR UNA FECHA");
            return false;
        }
        if (diasTxt.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "INGRESE LA CANTIDAD DE DIAS PARA VENCIMIENTO");
            diasTxt.requestFocus();
            return false;
        }
        Double t = Double.valueOf(totalTxt.getText().replace(",", ".")) * 100;
        Long t2 = t.longValue();
        if (t2 == 0) {
            JOptionPane.showMessageDialog(this, "Importe en cero");
            totalTxt.requestFocus();
            return false;
        }
        if (row < 1) {
            JOptionPane.showMessageDialog(this, "Debe seleccionar un periodo vÃ¡lido");
            return false;
        }
        if (proveedorSeleccionado == null) {
            JOptionPane.showMessageDialog(this, "Debe seleccionar un proveedor");
            codigoProveedorTxt.requestFocus();
            return false;
        }
        String l = comboLetraFactura.getSelectedItem().toString();
        if (l.equals("A") || l.equals("M") || l.equals("C")) {
            String cui = proveedorSeleccionado.getCuit().substring(0, 6);
            if (cui.equals("11-111")) {
                JOptionPane.showMessageDialog(this, "El proveedor no tiene un cuit vÃ¡lido");
                return false;
            }
        }
        if (nroSucursalTxt.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "NUMERO SUCURSAL INVALIDO");
            nroSucursalTxt.requestFocus();
            return false;
        }
        if (nroFacturTxt.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "NUMERO FACTURA INVALIDO");
            nroFacturTxt.requestFocus();
            return false;
        }
        int s = Integer.valueOf(nroSucursalTxt.getText());
        int n = Integer.valueOf(nroFacturTxt.getText());
        Boolean debito = true;
        if (facturaChk.isSelected()) {
            debito = true;
            tipoComp = "FC";
        } else {
            if (notaDebitoChk.isSelected()) {
                debito = true;
                tipoComp = "ND";
            } else {
                debito = false;
                tipoComp = "NC";
            }
        }
        if (comprobante == null) {
            ComprobanteCompras coms = null;
            try {
                coms = new ComprobanteComprasService().getComprobanteByProveedorAndNumero(proveedorSeleccionado, l, s, n, debito, tipoComp);
            } catch (Exception ex) {
                Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
            if (coms != null) {
                Boolean debitoPro = coms.getEsDebito();
                if (debitoPro == debito) {
                    JOptionPane.showMessageDialog(this, "Comprobante Existente");
                    return false;
                }
            }
        }
        Date hoy = new Date();
        Date ff = new Date();
        try {
            ff = sdf.parse(fechaFacturaTxt.getText());
        } catch (ParseException ex) {
            Logger.getLogger(NuevoComprobanteComprasFrame.class.getName()).log(Level.SEVERE, null, ex);
        }
        if (ff.after(hoy)) {
            JOptionPane.showMessageDialog(this, "Error fecha posterior a HOY");
            fechaFacturaTxt.requestFocus();
            return false;
        }
        return true;
    }

    private void calcularTotales2() {
        guardarBtn.setEnabled(true);
        Double xt = 0.00;
        if (!gravadoTxt.getText().isEmpty()) {
            xt += Double.valueOf(gravadoTxt.getText().replace(",", "."));
        }
        if (!noGravadoTxt.getText().isEmpty()) {
            xt += Double.valueOf(noGravadoTxt.getText().replace(",", "."));
        }
        if (!impuestoInternoTxt.getText().isEmpty()) {
            xt += Double.valueOf(impuestoInternoTxt.getText().replace(",", "."));
        }
        if (!percepcionIIBBTxt.getText().isEmpty()) {
            xt += Double.valueOf(percepcionIIBBTxt.getText().replace(",", "."));
        }
        if (!percepcionIvaTxt.getText().isEmpty()) {
            xt += Double.valueOf(percepcionIvaTxt.getText().replace(",", "."));
        }
        if (!otroTxt.getText().isEmpty()) {
            xt += Double.valueOf(otroTxt.getText().replace(",", "."));
        }
        if (!ivaTxt.getText().isEmpty()) {
            xt += Double.valueOf(ivaTxt.getText().replace(",", "."));
        }
        totalTxt.setText((df.format(xt)));
    }

    private void detalleNo() {
        detalle1Txt.setText("");
        detalle2Txt.setText("");
        detalle3Txt.setText("");
        detalle4Txt.setText("");
        detalle1Txt.setEditable(false);
        detalle2Txt.setEditable(false);
        detalle3Txt.setEditable(false);
        detalle4Txt.setEditable(false);
        impresionChk.setSelected(false);
        impresionChk.setEnabled(false);
    }

    private void detalleSi() {
//        detalle1Txt.setText("");
//        detalle2Txt.setText("");
//        detalle3Txt.setText("");
//        detalle4Txt.setText("");
        impresionChk.setEnabled(true);
        detalle1Txt.setEditable(true);
        detalle2Txt.setEditable(true);
        detalle3Txt.setEditable(true);
        detalle4Txt.setEditable(true);
        impresionChk.setSelected(true);
        comboLetraFactura.setSelectedIndex(5);
    }

    class MyPrintable implements Printable {

        public int print(Graphics g, PageFormat pf, int pageIndex) {
            if (pageIndex != 0) {
                return NO_SUCH_PAGE;
            }
            Graphics2D g2 = (Graphics2D) g;
            g2.setFont(new Font("Monospaced", Font.PLAIN, 8));
            g2.setPaint(Color.black);
            int row = 45;
            g2.setFont(new Font("Monospaced", Font.PLAIN, 14));
            String espacio = "                              ";
            g2.drawString(espacio + "X", 30, row);
            g2.setFont(new Font("Monospaced", Font.PLAIN, 8));
            g2.drawString("DISTRIBUIDORA A Y M", 50, row);
            row += 20;
            g2.drawString("COMPROBANTE DEVOLUCION", 50, row);
            row += 30;
            g2.drawString(proveedorSeleccionado.getRazonSocial(), 50, row);
            row += 30;
            String nf = comboLetraFactura.getSelectedItem().toString() + " " + nroSucursalTxt.getText() + "-" + nroFacturTxt.getText();
            g2.drawString("NÃºmero Comprobante: " + nf, 50, row);
            row += 20;
            g2.drawString("Fecha Comprobante: " + fechaFacturaTxt.getText(), 50, row);
            row += 45;
            g2.drawString(detalle1Txt.getText(), 50, row);
            row += 15;
            g2.drawString(detalle2Txt.getText(), 50, row);
            row += 15;
            g2.drawString(detalle3Txt.getText(), 50, row);
            row += 15;
            g2.drawString(detalle4Txt.getText(), 50, row);
            g2.drawString(totalTxt.getText(), 500, row);
            row += 25;
            g2.drawString("FIRMA:", 50, row);
            row += 25;
            g2.drawString("ACLARACION:", 50, row);
            row += 25;
            g2.drawString("DOCUMENTO:", 50, row);
            row = 455;
            g2.setFont(new Font("Monospaced", Font.PLAIN, 14));
            g2.drawString(espacio + "X", 30, row);
            g2.setFont(new Font("Monospaced", Font.PLAIN, 8));
            g2.drawString("DISTRIBUIDORA A Y M", 50, row);
            row += 20;
            g2.drawString("COMPROBANTE DEVOLUCION", 50, row);
            row += 30;
            g2.drawString(proveedorSeleccionado.getRazonSocial(), 50, row);
            row += 30;
            g2.drawString("NÃºmero Comprobante: " + nf, 50, row);
            row += 20;
            g2.drawString("Fecha Comprobante: " + fechaFacturaTxt.getText(), 50, row);
            row += 45;
            g2.drawString(detalle1Txt.getText(), 50, row);
            row += 15;
            g2.drawString(detalle2Txt.getText(), 50, row);
            row += 15;
            g2.drawString(detalle3Txt.getText(), 50, row);
            row += 15;
            g2.drawString(detalle4Txt.getText(), 50, row);
            g2.drawString(totalTxt.getText(), 500, row);
            row += 25;
            g2.drawString("FIRMA:", 50, row);
            row += 25;
            g2.drawString("ACLARACION:", 50, row);
            row += 25;
            g2.drawString("DOCUMENTO:", 50, row);
            return PAGE_EXISTS;
        }
    }
}
